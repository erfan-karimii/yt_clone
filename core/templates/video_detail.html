{% extends 'base.html' %}
{% load static %}

{% block body %}

<section class="mn-sec">
	<div class="container">

		<div class="row">
			<div class="col-lg-9">
				<div class="mn-vid-sc single_video">
					<div class="vid-1">
						<div class="vid-pr">
							<video
								id="my-video"
								class="video-js"
								controls
								preload="auto"
								width="640"
								height="264"
								poster="{{video.thumbnail.url}}"
								data-setup="{}"
								>
								<source src="{{video.video.url}}" type="video/mp4" />
								<source src="{% static 'demo_video.html' %}" type="video/webm" />
							</video>
						</div><!--vid-pr end-->
						<div class="vid-info">
							<h3>{{video.title}}</h3>
							<div class="info-pr">
								<span>{{video.visited}} بازدید</span>
								<br>
								<span>انتشار یافته در {{video.created.year}}/{{video.created.month}}/{{video.created.day}}</span>

								<ul class="pr_links">
									<li>
										<button id="like-video" data-toggle="tooltip" data-placement="top">
											<i class="icon-thumbs_up_fill"></i>
										</button>
										<div id="like-number">{{video.like.all.count}}</div>
									</li>
								</ul>
								<div class="clearfix"></div>
							</div><!--info-pr end-->
						</div><!--vid-info end-->
					</div><!--vid-1 end-->
					<div class="abt-mk">
						<div class="info-pr-sec">
							<div class="vcp_inf cr">
								<div class="vc_hd">
									<img src="{{video.youtuber.image.url}}" alt="">
								</div>
								<div class="vc_info pr">
									<h4><a href="#" title="">{{video.youtuber.channel_name}}</a></h4>
									<span>تعداد دنبال کننده  {{video.youtuber.count_followers}}</span>
								</div>
							</div><!--vcp_inf end-->							
							<ul class="chan_cantrz">
								<li>
									{% if is_followed %}
									<a href="javascript:void(0)" id="follow-button" title=""  class="subscribe">دنبال می کنید</a>
									{% else %}
									<a href="javascript:void(0)" id="follow-button" title=""  class="subscribe">دنبال کردن</a>
									{% endif %}
								</li>
								<li>
									<a href="#" title="" class="donate">هدیه دهید</a>
								</li>
							</ul><!--chan_cantrz end-->
							<ul class="df-list">
								<li>
									<button id='add-to-playlist' data-toggle="tooltip" data-placement="top" title="افزودن به لیست پخش">
										<i class="icon-add_to_playlist"></i>
									</button>
								</li>
								<li>
									<button class='watch_later' data-videoid='{{video.id}}' data-toggle="tooltip" data-placement="top" title="بعدا میبینم">
										<i class="icon-watch_later"></i>
									</button>
								</li>
								<li>
									<button data-toggle="tooltip" data-placement="top" title="اشتراک">
										<i class="icon-share"></i>
									</button>
								</li>
								<li>
									<button data-toggle="tooltip" data-placement="top" title="گزارش تخلف">
										<i class="icon-flag"></i>
									</button>
								</li>
							</ul><!--df-list end-->
							<div class="clearfix"></div>
						</div>
						<div class="clearfix"></div>
						<div class="about-ch-sec">
							<div class="abt-rw">
								<h4>درباره ویدیو : </h4>
								{{video.description|safe}}
							</div>
							<div class="abt-rw tgs">
								<h4>برچسب ها : </h4>
								<ul>
									{% for tag in video.tags.all %}
									<li><a href="#" title="{{tag.name}}">#{{tag.name}}</a></li>
									{% endfor %}
								</ul>
							</div>
						</div><!--about-ch-sec end-->
					</div><!--abt-mk end-->
					<div class="cmt-bx">
						<ul class="cmt-pr">
							<li><span>{{comments.count}}</span> کامنت</li>
							<li>
								<span></span>
							</li>
						</ul>
						<div class="clearfix"></div>
						<div class="clearfix"></div>
						<div class="vcp_inf pc">
							<div class="vc_hd">
								<img src="{{request.profile.image.url}}" alt="">
							</div>
							<form method='get'>
								<input id='comment-body' type="text" name='body' placeholder="دیدگاه خود را بنویسید" required='required'>
								<button id='save-comment' type="submit">ارسال دیدگاه</button>
							</form>
							<div class="clearfix"></div>
						</div><!--cmt-bx end-->
						<ul class="cmn-lst">
							{% for comment in comments %}
							<li>
								<div class="vcp_inf">
									<div class="vc_hd">
										<img src="{{comment.profile.image.url}}" alt="">
									</div>
									<div class="coments">
										{% if comment.is_pin_comment %}
										<div class="pinned-comment">
											<span><i class="icon-pinned"></i> پین شده توسط {{video.youtuber.channel_name}}</span>
										</div>
										{% endif %}
										<h2>{{comment.profile.channel_name}} <small class="posted_dt"> . {{comment.days_passed}}</small></h2>
										<p>{{comment.body}}</p>
										{% if video.youtuber == request.profile %}
										<ul class="cmn-i">
											<li>
												<a href="{% url 'youtube:delete_comment' comment.id %}?prev={{ request.path|urlencode }}" class='delete-comment'>
													حذف
												</a>
											</li>
											<li>
												<a href="{% url 'youtube:pin_comment' comment.id %}?prev={{ request.path|urlencode }}" class='pin-comment'>
													پین
												</a>
											</li>
										</ul>
										{% endif %}
									</div><!--coments end-->
								</div><!--vcp_inf end-->
							</li>
							{% endfor %}
						</ul><!--comment list end-->
					</div>
				</div>
			</div><!---col-lg-9 end-->
			<div class="col-lg-3">
				{% if is_play_list %}
				<div class="playlist_view">
					<div class="playlist_hd">
						<h3>{{play_list.name}} - <span id='playlist-count'></span></h3>
						<ul>
							<li>
								<a href="#" title="">
									<i class="icon-add_to_playlist"></i>
								</a>
							</li>
							<li>
								<a href="#" title="">
									<i class="icon-like"></i>
								</a>
							</li>
						</ul>
						<div class="clearfix"></div>
					</div><!--playlist_hd end-->
					<div class="clearfix"></div>
					<ul class="videos_lizt mCustomScrollbar" data-mcs-theme="dark">
						{% for  play_list_video in play_list.video.all  %}
						{% if video != play_list_video %}
						<li>
							<div class="vidz_row">
								<span class="vid_num">{{forloop.counter}}</span>
								<div class="vidz_img">
									<a href="{% url 'youtube:video_detail' play_list_video.id %}?playlist={{play_list.id}}" title="{{play_list_video.title}}">
										<img src="{{play_list_video.thumbnail.url}}" style="height: 84px;width: 100px;">
									</a>
									<span class="vid-time">{{play_list_video.video_time}}</span>
									<span class="watch_later" data-videoid='{{play_list_video.id}}'>
										<i class="icon-watch_later_fill"></i>
									</span>
								</div><!--vidz_img end-->
								<div class="video_info">
									<h3><a href="{% url 'youtube:video_detail' play_list_video.id %}?playlist={{play_list.id}}">{{play_list_video.title}}</a></h3>
									<h4><a href="{% url 'youtube:channel_home_page' play_list_video.youtuber.id %}" title="{{play_list_video.youtuber.channel_name}}">{{play_list_video.youtuber.channel_name}}</a></h4>
								</div>
							</div><!--vidz_row end-->
						</li>
						{% else %}
						<input id='s-number' type='hidden' value='{{forloop.counter}}'>
						{% endif %}

						{% endfor %}
					</ul><!--videos_lizt end-->
				</div><!--playlist_view end-->
				{% endif %}
				<div class="sidebar">
					<div class="vidz-prt">
						<h2 class="sm-vidz">ویدیو های مشابه</h2>
						<div class="clearfix"></div>
					</div><!--vidz-prt end-->
					<div class="videoo-list-ab">
						{% for video in similar_videos %}
						{% if forloop.counter == 2 %}
						<div class="ad-rw">
							<img src="{% static 'images/resources/ad-img.jpg' %}" alt="">
						</div>
						{% endif %}
						<div class="videoo">
							<div class="vid_thumbainl">
								<a href="{% url 'youtube:video_detail' id=video.id %}" title="{{video.title}}">
									<img src="{{video.thumbnail.url}}" alt="{{video.title}}">
									<span class="vid-time">{{video.video_time}}</span>
									<span class="watch_later" data-videoid='{{video.id}}'>
										<i class="icon-watch_later_fill"></i>
									</span>
								</a>	
							</div><!--vid_thumbnail end-->
							<div class="video_info">
								<h3><a href="{% url 'youtube:video_detail' id=video.id %}">{{video.title}}</a></h3>
								<h4><a href="{% url 'youtube:channel_home_page' id=video.youtuber.id %}" title="{{video.youtuber.channel_name}}">{{video.youtuber.channel_name}}</a> <span class="verify_ic"><i class="icon-tick"></i></span></h4>
								<span>{{video.visited}} بازدید .<small class="posted_dt">{{video.days_passed}}</small></span>
							</div>
						</div><!--videoo end-->
						{% endfor %}						
					</div><!--videoo-list-ab end-->
				</div><!--side-bar end-->
			</div>
		</div>
	</div>
</section><!--mn-sec end-->

<section class="more_items_sec text-center">
	<div class="container">
		<a href="#" title="">
			<svg width="19" height="24" viewBox="0 0 19 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M18.1618 24.0001H0.838235C0.374412 24.0001 0 23.6261 0 23.1628V5.86052C0 5.39727 0.374412 5.02332 0.838235 5.02332H18.1618C18.6256 5.02332 19 5.39727 19 5.86052V23.1628C19 23.6261 18.6256 24.0001 18.1618 24.0001ZM1.67647 22.3256H17.3235V6.69773H1.67647V22.3256Z" fill="#9494A0"/>
				<g opacity="0.25">
				<path opacity="0.25" d="M13.1324 4.18605C12.6685 4.18605 12.2941 3.81209 12.2941 3.34884V1.67442H6.70589V3.34884C6.70589 3.81209 6.33148 4.18605 5.86765 4.18605C5.40383 4.18605 5.02942 3.81209 5.02942 3.34884V0.83721C5.02942 0.373954 5.40383 0 5.86765 0H13.1324C13.5962 0 13.9706 0.373954 13.9706 0.83721V3.34884C13.9706 3.81209 13.5962 4.18605 13.1324 4.18605Z" fill="#9494A0"/>
				</g>
				<path d="M9.50001 19.3479C9.28487 19.3479 9.06972 19.267 8.90766 19.1024L5.92634 16.1275C5.59942 15.801 5.59942 15.2707 5.92634 14.9442C6.25325 14.6177 6.78413 14.6177 7.11104 14.9442L9.50001 17.3275L11.8862 14.9442C12.2131 14.6177 12.744 14.6177 13.0709 14.9442C13.3978 15.2707 13.3978 15.801 13.0709 16.1275L10.0924 19.1024C9.93031 19.267 9.71516 19.3479 9.50001 19.3479Z" fill="#9494A0"/>
				<path d="M9.49999 18.4186C9.03617 18.4186 8.66176 18.0447 8.66176 17.5814V10.3256C8.66176 9.86236 9.03617 9.4884 9.49999 9.4884C9.96382 9.4884 10.3382 9.86236 10.3382 10.3256V17.5814C10.3382 18.0447 9.96382 18.4186 9.49999 18.4186Z" fill="#9494A0"/>
				<g opacity="0.5">
				<path opacity="0.5" d="M15.6471 6.69764C15.1832 6.69764 14.8088 6.32369 14.8088 5.86043V4.18601H4.19118V5.86043C4.19118 6.32369 3.81677 6.69764 3.35294 6.69764C2.88912 6.69764 2.51471 6.32369 2.51471 5.86043V3.34881C2.51471 2.88555 2.88912 2.5116 3.35294 2.5116H15.6471C16.1109 2.5116 16.4853 2.88555 16.4853 3.34881V5.86043C16.4853 6.32369 16.1109 6.69764 15.6471 6.69764Z" fill="#9494A0"/>
				</g>
			</svg>
		</a>
	</div>
</section><!--more_items_sec end-->

{% endblock body %}

{% block js %}
<script>
$(document).ready(function(){
	$('#like-video').click(function(){
		$.ajax({
			type : 'GET',
			url : '{% url "youtube:like_video" %}',
			data : {'video_id': '{{video.id}}',},
			dataType : 'json',
			success : function (data) {
				if(data.status == 'added'){
					$('#like-number').text(parseInt($('#like-number').text())+1)
					alert('شما لایک کردید')
				}else if(data.status == 'removed'){
					$('#like-number').text(parseInt($('#like-number').text())-1)
					alert('شما لایک خود را برداشتید')
				}
			},  
			error: function(data){
				alert('مشکلی پیش امده است لطفا دوباره امتحان کنید.');
			}                                
		});
	});
	$('#follow-button').click(function(){
		$.ajax({
			type : 'GET',
			url : '{% url "youtube:follow_channel" %}',
			data : {'yt_user': '{{video.youtuber.id}}'},
			dataType : 'json',
			success : function (data) {
				if(data.status == 'added'){
					$('#follow-button').text('دنبال می کنید')
					alert('شما الان دنبال می کنید')
				}else if(data.status == 'removed'){
					$('#follow-button').text('دنبال کردن')
					alert('شما الان دنبال نمی کنید')
				}else if(data.status == 'same'){
					alert('شما نمی توانید خودتان دنبال کنید.')
				}
			},  
			error: function(data){
				alert('مشکلی پیش امده است لطفا دوباره امتحان کنید.');
			}                                
		});
	});	
	$('#add-to-playlist').click(function(){
		$.ajax({
			type : 'GET',
			url : '{% url "youtube:get_playlist" %}',
			success : function (data) {
				var text = '<ul>'
				for (playlist of data.playlists) {
					text = text + `<li onclick=addPlaylist('${playlist}')>` + playlist + '</li>'
				}
				text = text + '</ul>'
				Swal.fire({
					title: 'پلی لیست خود را انتخاب کنید.',
					html: text,
					icon: 'info',
					confirmButtonText: 'ساخت پلی لیست جدید',
					confirmButtonColor: '#3085d6',
					showCancelButton: true,
					cancelButtonText: 'برگشت',
					cancelButtonColor: '#d33',
					input: 'text',
					inputAttributes: {
						required: 'true'
					},
					}).then((result) => {
					if (result.isConfirmed) {
						createPlaylist(result)
					}
				});

			},  
			error: function(data){
				alert('مشکلی پیش امده است لطفا دوباره امتحان کنید.');
			}                                
		});
	});
	$('#save-comment').click(function(e){
		e.preventDefault()
		value = $('#comment-body').val()
		$.ajax({
			type : 'GET',
			url : '{% url "youtube:save_comment" %}',
			data : {'comment_body': value,'video_id':'{{video.id}}'},
			dataType : 'json',
			success : function (data) {
				$('#comment-body').val('')
				Swal.fire({
					icon:  data.icon,
					text : data.status,
				});
			},  
			error: function(data){
				alert('مشکلی پیش امده است لطفا دوباره امتحان کنید.');
			}                                
		});
	})	
});
function addPlaylist(name) {
	$.ajax({
		type : 'GET',
		url : '{% url "youtube:add_video_to_playlist" %}',
		data : {"playlist_name":name,'video_id': '{{video.id}}'},
		dataType : 'json',
		success : function (data) {
			alert(data.status)
		},  
		error: function(data){
			alert('مشکلی پیش امده است لطفا دوباره امتحان کنید.');
		}                                
	});	
}
function createPlaylist(result) {
	$.ajax({
		type : 'GET',
		url : '{% url "youtube:create_playlist" %}',
		data : {'playlist_name':result.value,'video_id': '{{video.id}}'},
		dataType : 'json',
		success : function(data){
			alert(data.status)
		},
		error: function(data){
			alert('مشکلی پیش امده است لطفا دوباره امتحان کنید.');
		}, 
	});
	
}
window.onload = function playListCount(){
	number = $('#s-number').val()
	$('#playlist-count').text(number + '/ {{play_list.video.all.count}}')
}
</script>
{% endblock js %}